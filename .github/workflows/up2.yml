name: 读取Windows服务器D盘目录

on:
  workflow_dispatch:
  push:
    branches: [ main ]


jobs:
  read-directory:
    runs-on: ubuntu-latest


    steps:
      - name: 检出代码
        uses: actions/checkout@v3

      - name: 上传PowerShell脚本到Windows服务器
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.WIN_IP }}
          username: ${{ secrets.SERVER_USERNAME }}
          password: ${{ secrets.SERVER_PASSWORD }}
          port: 22
          source: "scripts/read_drive_d.ps1"
          target: "D:/"
          strip_components: 1
          # 确保目标目录存在
          rm: false
          debug: true

      - name: 连接Windows服务器并执行上传的脚本文件
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.WIN_IP }}
          username: ${{ secrets.SERVER_USERNAME }}
          password: ${{ secrets.SERVER_PASSWORD }}
          port: 22
          # 执行上传到服务器的PowerShell脚本文件
          script: |
            powershell -ExecutionPolicy Bypass -File "D:/read_drive_d.ps1"