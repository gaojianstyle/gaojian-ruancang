name: 验证 D 盘创建文件
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test-d-create:
    runs-on: ubuntu-latest
    steps:
      - name: 安装依赖
        run: sudo apt-get install -y sshpass

      - name: 测试 D 盘创建文件（极简命令）
        run: |
          # 直接执行单条命令链，避免脚本块解析问题
          sshpass -p "${{ secrets.SERVER_PASSWORD }}" ssh -tt -o StrictHostKeyChecking=no -p 22 ${{ secrets.SERVER_USERNAME }}@${{ secrets.WIN_IP }} "cmd /c \"
            echo 开始测试 && 
            if exist d:\\ (
              echo D盘存在 && 
              echo 测试内容 > d:\\test_from_github.txt && 
              if exist d:\\test_from_github.txt (
                echo  ✅ 文件创建成功 && 
                type d:\\test_from_github.txt
              ) else (
                echo  ❌ 文件创建失败 && exit 1
              )
            ) else (
              echo  ❌ D盘不存在 && exit 1
            ) && 
            exit
          \""